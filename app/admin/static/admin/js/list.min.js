window.ListPage=class extends Page{constructor(){super(),this.store=new QueryStringManager,this.displayManager=null,"mobile"===this.device?this.displayManager=new CardsManager($(".card")):this.displayManager=new TableManager($("table"))}setup(){super.setup();const d=this.device,e=$("#page-size-select");e.selectpicker({mobile:"mobile"===d});var i,t=this.store.get("ps")||"10";if(e.selectpicker("val",t),e.on("changed.bs.select",(e,t,i,n)=>{this.store.set("ps",e.target.options[e.target.selectedIndex].value,!0)}),"mobile"!==this.device){const a=new TemplateManager($(".card-header"));a.init(),a.templates["all-records-actions"].init=()=>{0===document.importNode($("template[data-type=filters]")[0].content,!0).querySelector("#side-sheet__inner__content__field-type__select").children.length&&$(".sidebar-action-btn[data-type=filters]").attr("disabled",!0)},a.templates["selected-records-actions"].init=e=>{a.$container.find("#selected-records-text").text(e.checkedNum+" selected");const t=$("#records-action-dropdown"),i=$("select").not("#page-size-select");for(var n of i.children()){const s=$(n);s.attr("value")&&t.find(".dropdown-menu").append($(`<a class="dropdown-item" value="${s.attr("value")}" href="#">${s.text()}</a>`))}t.find(".dropdown-item").on("click",e=>{i.find("option").each((e,t)=>{t.removeAttribute("selected")});const t=i.find(`option[value=${e.target.getAttribute("value")}]`)[0];t.setAttribute("selected",""),$("form").submit()})},a.activateTemplate("all-records-actions"),this.displayManager.onCheck=e=>{e?(a.deactivateTemplate(),a.activateTemplate("selected-records-actions",{checkedNum:e})):(a.deactivateTemplate(),a.activateTemplate("all-records-actions"))}}else $("#top-navbar-lower__mobile-actions-container").append(`
				<div class="dropdown">
                <i class="material-icons clickable" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">more_vert</i>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a id="trigger-filters-mobile" class="dropdown-item with-icon" href="javascript:document.querySelector('button[data-type=filters]').click()"><i class="material-icons">filter_list</i>Filter</a>
                        <a id="trigger-sort-mobile" class="dropdown-item with-icon" href="javascript:document.querySelector('button[data-type=sort]').click()"><i class="material-icons">sort</i>Sort</a>
                    </div>
                </div>
			`);const r=new TemplateManager($("#side-sheet__content"));if(r.init(),r.templates.filters.init=()=>{$("[class*=ss-]").not("[class*=ss-"+this.device+"]").remove();const l=r.$container.find("#side-sheet__inner__content__field-type__select");if(0===l.find("option").length)return void $(".sidebar-action-btn[data-type=filters]")[0].setAttribute("disabled","");const o=r.$container.find("#side-sheet__inner__footer__save-btn");function n(e,t){return""!==t.trim()?(o.removeAttr("disabled"),!0):(o.prop("disabled",!0),!1)}const s=e=>{var t=l.find("option:selected").val();let i="";i="boolean"===e?METADATA.mapping.filterOperators[c.$container.find("input[type='checkbox']")[0].checked?"is":"isNot"]:METADATA.mapping.filterOperators[c.$container.find("input[type='radio']:checked").attr("id")];let n="";if(["text","number","date","time","datetime"].includes(e)){const a=c.$container.find("input[type='text']");n=a.val(),a.val("")}else if(["enum","relationship"].includes(e)){const o=r.$container.find("select:visible").not(l);n=o.find("option:selected").val(),o.val(o.find("option:first").val())}else n=METADATA.mapping.defaults.boolean.positive;const s=JSON.parse(this.store.get("f"))||[];s.push(t+"__"+i+"__"+n),this.store.set("f",JSON.stringify(s),!0)},c=new TemplateManager($("#side-sheet__inner__content__field-type__content"));c.init(),c.templates.text.init=function(){c.$container.find("input[type='text']").keyup(function(){n(0,this.value.trim())?this.parentElement.classList.add("has-value"):this.parentElement.classList.remove("has-value")}),o.on("click",function(){s("text")})},c.templates.text.destroy=function(){o.off("click")},c.templates.number.init=function(){c.$container.find("input[type='number']").keyup(function(){n(0,this.value.trim())?this.parentElement.classList.add("has-value"):this.parentElement.classList.remove("has-value")}),o.on("click",function(){s("number")})},c.templates.number.destroy=function(){o.off("click")},c.templates.boolean.init=function(){o.removeAttr("disabled"),o.on("click",function(){s("boolean")})},c.templates.boolean.destroy=function(){o.off("click")},c.templates.date.init=function(){r.$container.find(".datepicker").each(function(e,t){const i=$(t);i.datepicker({format:METADATA.formats.gijgo.frontend.date,icons:{rightIcon:'<i class="material-icons clickable">today</i>',previousMonth:'<i class="material-icons clickable">keyboard_arrow_left</i>',nextMonth:'<i class="material-icons clickable">keyboard_arrow_right</i>'}}),i.on("change",function(){n(0,i.val())?this.parentElement.classList.add("has-value"):this.parentElement.classList.remove("has-value")}),o.on("click",function(){s("date")})})},c.templates.date.destroy=function(){o.off("click")},c.templates.time.init=function(){r.$container.find(".timepicker").each(function(e,t){const i=$(t);i.timepicker({modal:!1,icons:{rightIcon:'<i class="material-icons clickable">schedule</i>'},footer:!0,mode:"24hr",format:METADATA.formats.gijgo.frontend.time,showOnFocus:!1}),i.on("click",function(){i.next().click()}),i.on("change",function(){n(0,i.val())?this.parentElement.classList.add("has-value"):this.parentElement.classList.remove("has-value")}),o.on("click",function(){s("time")})})},c.templates.time.destroy=function(){o.off("click")},c.templates.datetime.init=()=>{r.$container.find(".datetimepicker").each((e,t)=>{const i=$(t);i.datetimepicker({icons:{rightIcon:'<i class="material-icons clickable">today</i>',previousMonth:'<i class="material-icons clickable">keyboard_arrow_left</i>',nextMonth:'<i class="material-icons clickable">keyboard_arrow_right</i>'},modal:"mobile"===this.device,format:METADATA.formats.gijgo.frontend.datetime}),i.on("click",function(){i.next().click()}),i.on("change",function(){n(0,i.val())?this.parentElement.classList.add("has-value"):this.parentElement.classList.remove("has-value")}),o.on("click",function(){s("datetime")})})},c.templates.datetime.destroy=function(){o.off("click")},c.templates.enum.init=function(){const e=$(`.selectpicker[data-field=${l.find("option:selected").val()}]`);c.$container.find(".material-select").not(e.parent()).hide(),e.selectpicker({}),e.closest(".material-select").addClass("has-value"),o.removeAttr("disabled"),o.on("click",function(){s("enum")})},c.templates.enum.destroy=function(){o.off("click")},c.templates.relationship.init=function(){const e=$(`.selectpicker[data-field=${l.find("option:selected").val()}]`);c.$container.find(".material-select").not(e.parent()).hide(),e.selectpicker({liveSearch:10<e.children().length,liveSearchPlaceholder:"Search ..."}),e.closest(".material-select").addClass("has-value"),o.removeAttr("disabled"),o.on("click",function(){s("relationship")})},c.templates.relationship.destroy=function(){o.off("click")},l.selectpicker({mobile:"mobile"===d}),l.closest(".material-select").addClass("has-value"),c.activateTemplate(l.find("option:selected").data("type")),l.on("changed.bs.select",function(e,t,i,n){var s=e.target.options[e.target.selectedIndex].dataset.type;if("mobile"===d){const a=l.siblings("button");a.attr("title",e.target.options[e.target.selectedIndex].textContent),a.find(".filter-option-inner-inner").text(e.target.options[e.target.selectedIndex].textContent)}o.prop("disabled",!0),c.deactivateTemplate(),c.activateTemplate(s)})},r.templates.sort.init=()=>{const a=r.$container.find("#side-sheet__inner__content__field-type__select");if(0!==a.find("option").length){(()=>{const e=getQuerystring(window.location.search,"o");let t=e;e&&(e.startsWith("-")?($("input[name=sort-direction-radio][id*=desc]")[0].checked=!0,t=e.replace("-","")):$("input[name=sort-direction-radio][id*=asc]")[0].checked=!0,a.find("option").eq(parseInt(t)-1).prop("selected",!0))})(),a.selectpicker({mobile:"mobile"===d}),a.closest(".material-select").addClass("has-value");const e=$("#side-sheet__inner__footer__save-btn");e.on("click",e=>{var t=a.find("option:selected").index()+1,i=$("input[name=sort-direction-radio]:checked").attr("id").includes("asc")?"":"-";this.store.set("o",i+t,!0)}),a.on("changed.bs.select",function(e,t,i,n){if("mobile"===d){const s=a.siblings("button");s.attr("title",e.target.options[e.target.selectedIndex].textContent),s.find(".filter-option-inner-inner").text(e.target.options[e.target.selectedIndex].textContent)}})}else $(".sidebar-action-btn[data-type=sort]")[0].setAttribute("disabled","")},r.templates["applied-filters-mobile"].init=()=>{$("#side-sheet").addClass("minimized"),$("body").addClass("side-sheet-minimized"),$(".filter-chip.selectable").on("click",function(){$(this).toggleClass("is-selected"),0<$(".filter-chip.selectable.is-selected").length?$("#side-sheet__inner__footer__save-btn").text("Clear Selected"):$("#side-sheet__inner__footer__save-btn").text("Clear All")}),$("#side-sheet__inner__footer__save-btn").on("click",e=>{$(".filter-chip.selectable.is-selected").each((e,t)=>{const i=t.dataset.urlExpression;let n=JSON.parse(this.store.get("f"))||[];n=n.filter(function(e){return e!==i}),this.store.set("f",0<n.length?JSON.stringify(n):null,!1)}),this.store.reload()})},r.templates["applied-filters-mobile"].destroy=()=>{$("#side-sheet").removeClass("minimized"),$("body").removeClass("side-sheet-minimized"),$(".filter-chip.selectable").off("click")},r.templates["selection-actions-mobile"].init=()=>{$("#side-sheet").addClass("minimized"),$("body").addClass("side-sheet-minimized");const e=$("#side-sheet__inner__footer__save-btn");$("#select-all-mobile").on("click",function(){$(".card").addClass("selected");var e=$(".card.selected").length;$(".side-sheet__inner__headline__text").text(e+" selected")}),$("#unselect-all-mobile").on("click",function(){r.$container.find("#side-sheet__inner__headline__close-btn").trigger("click"),$(".card").removeClass("selected"),$(".main").hasClass("has-filters")&&$(".sidebar-action-btn[data-type=applied-filters-mobile]").trigger("click")});const t=$("select[name=action]");var i=Array.from(t.find('option:not([value=""])')).map(e=>[e.getAttribute("value"),e.textContent]);const n=$('<div class="choice-group"></div>');for(let e=0;e<i.length;e++)n.append(`
					<div class="material-checkbox">
						<input type="radio" id="${i[e][0]}" name="selection__action"/>
						<label for="${i[e][0]}">${i[e][1]}</label>
					</div>
				`);n.appendTo($(".side-sheet__inner__mobile__selection-actions")),$("[name=selection__action]").on("change",function(){t.val(this.id),t.appendTo($("<div hidden></div>")).appendTo($("form")),t.hide(),e.removeAttr("disabled")}),e.on("click",function(){$("form").submit()})},r.templates["selection-actions-mobile"].destroy=()=>{$("#side-sheet").removeClass("minimized"),$("body").removeClass("side-sheet-minimized"),$("[name=selection__action]").off("change"),$("#side-sheet__inner__footer__save-btn").off("click")},$document.on("click",".sidebar-action-btn",function(e){const t=$("#side-sheet");this.getAttribute("disabled")||setTimeout(()=>{t.hasClass("expanded")?t.hasClass("minimized")&&(r.deactivateTemplate(),r.activateTemplate(e.target.dataset.type)):(r.activateTemplate(e.target.dataset.type),t.addClass("expanded"),$(document.body).addClass("side-sheet-shown"),t.hasClass("minimized")?(document.body.classList.add("side-sheet-minimized"),t.addClass("minimized"),t.find("#side-sheet__inner__headline__close-btn").on("click",function(){t.removeClass("minimized"),$("meta[name=theme-color]").attr("content","#020d2b")})):(document.documentElement.style.overflowY="hidden",$("meta[name=theme-color]").attr("content","#020d2b")))},0)}),$document.on("click","#side-sheet__inner__headline__close-btn",function(){r.deactivateTemplate(),$("#side-sheet").removeClass("expanded"),$(document.body).removeClass("side-sheet-shown"),document.querySelector(".main").style.width="100%",document.querySelector(".top-navbar").style.width="100%",document.documentElement.style.overflowY="initial",$("meta[name=theme-color]").attr("content",$(document).data("original-theme-color")),setTimeout(function(){$(".main").hasClass("has-filters")&&"mobile"===d&&$(".sidebar-action-btn[data-type=applied-filters-mobile]").trigger("click")},300)}),$document.on("click","#side-sheet__inner__headline__expand-btn",function(){const e=$(this).closest("#side-sheet");e.toggleClass("minimized"),$(document.body).toggleClass("side-sheet-minimized"),$(this).toggleClass("rotate");const t=$("meta[name=theme-color]");"#010a1d"===t.attr("content")?t.attr("content",$(document).data("original-theme-color")):t.attr("content","#010a1d")}),$document.on("click","#side-sheet__backdrop",function(){$("#side-sheet__inner__headline__close-btn").trigger("click")}),"mobile"===this.device){$(document).on("touchstart",".card",function(){const t=$(this);i=window.setTimeout(function(){var e=$(".card.selected").length;0===e?$(".sidebar-action-btn[data-type=selection-actions-mobile]").trigger("click"):$(".side-sheet__inner__headline__text").text(e+1+" selected"),t.addClass("selected"),t.find(".record-header > input")[0].checked=!0},800)}),$(document).on("touchmove",function(){clearTimeout(i)}),$(document).on("click",".card",function(){var e=$(".card.selected").length;if(0!==e){const t=$(this);t.addClass("selected"),t.find(".record-header > input")[0].checked=!0,$(".side-sheet__inner__headline__text").text(e+1+" selected")}}),$(document).on("touchend",".card",function(){clearTimeout(i)}),$(".card-selection-backdrop__btn").on("click",function(e){e.preventDefault(),e.stopPropagation();const t=$(this).closest(".card");t.removeClass("selected"),t.find(".record-header > input")[0].checked=!1;e=$(".card.selected").length;0===e?($(".main").hasClass("has-filters")?$(".sidebar-action-btn[data-type=applied-filters-mobile]"):$("#side-sheet").find("#side-sheet__inner__headline__close-btn")).trigger("click"):$(".side-sheet__inner__headline__text").text(e+" selected")});const s=$("#page-size-select").parent(),o=$("#paging-info__text"),l=$("#paging-info__nav-buttons");s.appendTo($("#paging-info__mobile__wrap")),o.prependTo($("#mobile-paging-info-heading")),l.appendTo($("#mobile-paging-info-footing")),$("<span>per page </span>").insertBefore(s)}else $(".filter-chip.selectable").on("click",e=>{const t=e.currentTarget.dataset.urlExpression;let i=JSON.parse(this.store.get("f"))||[];i=i.filter(function(e){return e!==t}),this.store.set("f",0<i.length?JSON.stringify(i):null,!0)});const n=$("form");if(void 0!==n.attr("has-filters")&&($(".main").addClass("has-filters"),n.removeAttr("has-filters")),"mobile"===d&&null===localStorage.getItem("selection-understood")){let e=0;0!==document.getElementsByClassName("paper-snackbar").length&&(e=5100),setTimeout(function(){createSnackbar("Press and hold any record box to toggle selection.","Got it",function(e){localStorage.setItem("selection-understood",{}),$(this.parentElement).fadeOut(500)})},e)}0===document.importNode($("template[data-type=filters]")[0].content,!0).querySelector("#side-sheet__inner__content__field-type__select").children.length&&($(".sidebar-action-btn[data-type=filters]").attr("disabled",!0),"mobile"===d&&$("#trigger-filters-mobile").addClass("disabled")),0===document.importNode($("template[data-type=sort]")[0].content,!0).querySelector("#side-sheet__inner__content__field-type__select").children.length&&($(".sidebar-action-btn[data-type=sort]").attr("disabled",!0),"mobile"===d&&$("#trigger-sort-mobile").addClass("disabled"))}rendered(){super.rendered(),"mobile"!==this.device&&this.displayManager.tooltipOverflownTd()}};